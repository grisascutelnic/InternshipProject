<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

  <!-- ** Basic Page Needs ** -->
  <meta charset="utf-8">
  <title>OmniPro</title>

  <!-- ** Mobile Specific Metas ** -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Agency HTML Template">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Themefisher Classified Marketplace Template v1.0">

  <!-- favicon -->
  <link th:href="@{/images/favicon.png}" rel="shortcut icon">

  <!-- 
  Essential stylesheets
  =====================================-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">-->

  <link th:href="@{/plugins/bootstrap/bootstrap.min.css}" rel="stylesheet">
  <link th:href="@{/plugins/bootstrap/bootstrap-slider.css}" rel="stylesheet">
  <link th:href="@{/plugins/font-awesome/css/font-awesome.min.css}" rel="stylesheet">
  <link th:href="@{/plugins/slick/slick.css}" rel="stylesheet">
  <link th:href="@{/plugins/slick/slick-theme.css}" rel="stylesheet">
  <link th:href="@{/plugins/jquery-nice-select/css/nice-select.css}" rel="stylesheet">

  <link th:href="@{/css/style.css}" rel="stylesheet">

</head>

<body class="body-wrapper">

<!--/ Nav Start /-->
<div th:replace="~{/fragments/navbar :: navbar}"></div>
<!--/ Nav End /-->

<!--==================================
=            User Profile            =
===================================-->
<section class="dashboard section">
  <!-- Container Start -->
  <div class="container">
    <!-- Row Start -->
    <div class="row">
      <div class="col-lg-4">
        <div class="sidebar">
          <!-- User Widget -->
          <div class="widget user-dashboard-profile">
            <!-- User Image -->
            <div class="image d-flex justify-content-center">
<!--              <img th:src="'data:image/jpeg;base64,' + ${profile.base64Image}" alt="Profile Image" class="profile-image rounded-circle">-->
              <img th:src="${profile.image != null} ? 'data:image/jpeg;base64,' + ${profile.base64Image} : @{/images/default-profile.jpg}"
                   alt="Profile Image" class="profile-image rounded-circle">

            </div>
            <!-- User Name -->
            <h5 class="text-center" th:text="${profile.firstName} + ' ' + ${profile.lastName}"></h5>
            <p th:text="'Enregistré le ' + ${#dates.format(profile.registrationDate, 'yyyy-MM-dd HH:mm')}"></p>
            <a th:if="${authenticatedEmail != null && profile.email == authenticatedEmail}" th:href="@{/profile/editProfile/{id}(id=${profile.id})}" class="btn btn-main-sm">Modifier le profil</a>

                     <!--Start Rating-->

            <div class="rating">
    <span th:each="i : ${#numbers.sequence(1, 5)}"
          th:class="${profile.rating >= i} ? 'star filled' : 'star'"
          th:data-index="${i}"
          class="star"
          onclick="rateProfile(${profile.id}, ${i})">&#9733;</span>
            </div>



            <!--End Rating-->

          </div>
          <!-- Dashboard Links -->
          <div class="widget user-dashboard-menu" th:if="${authenticatedEmail != null && profile.email == authenticatedEmail}">
            <ul>
              <li class="active">
                <a
                   th:href="@{/profile/{id}(id=${profile.id})}"
                   th:text="'Mes annonces'">
                  <!-- Acest text va apărea dacă utilizatorul este autentificat și vizualizează propriul profil -->
                </a>
<!--                <a th:unless="${authenticatedEmail != null && profile.email == authenticatedEmail}"-->
<!--                   th:href="@{/profile/{id}(id=${profile.id})}"-->
<!--                   th:text="'Annonces'">-->
<!--                  &lt;!&ndash; Acest text va apărea dacă utilizatorul nu este autentificat sau vizualizează alt profil &ndash;&gt;-->
<!--                </a>-->
              </li>

<!--              <li><a href="dashboard-favourite-ads.html"><i class="fa fa-bookmark-o"></i> Favourite Ads-->
<!--                  <span>5</span></a></li>-->
<!--              <li><a href="dashboard-archived-ads.html"><i class="fa fa-file-archive-o"></i>Archived Ads-->
<!--                  <span>12</span></a></li>-->
<!--              <li><a href="dashboard-pending-ads.html"><i class="fa fa-bolt"></i> Pending Approval<span>23</span></a>-->
<!--              </li>-->
              <li><a th:if="${authenticatedEmail != null && profile.email == authenticatedEmail}" th:href="@{/logout}"><i class="fa fa-cog"></i> Déconnexion</a></li>
              <li><a th:if="${authenticatedEmail != null && profile.email == authenticatedEmail}" href="#!" data-toggle="modal" data-target="#deleteaccount"><i class="fa fa-power-off"></i>Supprimer le compte</a></li>
            </ul>
          </div>
          
          <!-- delete-account modal -->
          <!-- delete account popup modal start-->
<!-- Modal -->
<div class="modal fade" id="deleteaccount" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body text-center">
        <img src="images/account/Account1.png" class="img-fluid mb-2" alt="">
        <h6 class="py-2">Êtes-vous sûr de vouloir supprimer votre compte ?</h6>
        <p>Voulez-vous vraiment supprimer ces enregistrements ? Ce processus est irréversible.</p>
<!--        <textarea class="form-control w-100 rounded" name="message" id="" cols="40" rows="4" ></textarea>-->
      </div>
      <div class="modal-footer border-top-0 mb-3 mx-5 justify-content-center">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-danger">Supprimer</button>
      </div>
    </div>
  </div>
</div>
<!-- delete account popup modal end-->
          <!-- delete-account modal -->

        </div>
      </div>
      <div class="col-lg-8">
        <!-- Recently Favorited -->
        <div class="widget dashboard-container my-adslist">
          <h3 class="widget-header">Mes annonces</h3>
          <table class="table table-responsive product-dashboard-table">
            <thead>
            <tr>
              <th>L'image</th>
              <th>Titre du produit</th>
              <th class="text-center">Catégorie</th>
              <th class="text-center">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="announcement : ${announcements}">
              <td class="product-thumb">
                <img width="80px" height="auto"
                     th:if="${announcement.base64Image != null}"
                     th:src="'data:image/jpeg;base64,' + ${announcement.base64Image}"
                     alt="image description">
              </td>
              <td class="product-details">
                <h3 class="title" th:text="${announcement.title}">Macbook Pro 15inch</h3>
                <span class="add-id"><strong>Ad ID:</strong> <span th:text="${announcement.id}">ng3D5hAMHPajQrM</span></span>
                <span><strong>Posted on: </strong><time th:text="${announcement.date}">Jun 27, 2017</time></span>
<!--                <span class="status active"><strong>Status</strong><span th:text="${announcement.number}">Active</span></span>-->
<!--                <span class="location"><strong>Location</strong><span th:text="${announcement.location}">Dhaka, Bangladesh</span></span>-->
              </td>
              <td class="product-category"><span class="categories" th:text="${announcement.category}">Laptops</span></td>
              <td class="action" data-title="Action">
                <div class="">
                  <ul class="list-inline justify-content-center">
                    <li class="list-inline-item">
                      <a data-toggle="tooltip" data-placement="top" title="view" class="view"
                         th:href="@{/announcements/viewAnnouncement/{id}(id=${announcement.id})}">
                        <i class="fa fa-eye"></i>
                      </a>
                    </li>
                    <li class="list-inline-item" th:if="${authenticatedEmail != null && profile.email == authenticatedEmail}">
                      <a class="edit" data-toggle="tooltip" data-placement="top" title="Edit"
                         th:href="@{/announcements/edit/{id}(id=${announcement.id})}">
                        <i class="fa fa-pencil"></i>
                      </a>
                    </li>
                    <li class="list-inline-item" th:if="${authenticatedEmail != null && profile.email == authenticatedEmail}">
                      <a class="delete" data-toggle="tooltip" data-placement="top" title="Delete"
                         th:href="@{/announcements/deleteAnnouncement/{id}(id=${announcement.id})}">
                        <i class="fa fa-trash"></i>
                      </a>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </div>


        <!-- pagination -->
<!--        <div class="pagination justify-content-center">-->
<!--          <nav aria-label="Page navigation example">-->
<!--            <ul class="pagination">-->
<!--              <li class="page-item">-->
<!--                <a class="page-link" href="dashboard.html" aria-label="Previous">-->
<!--                  <span aria-hidden="true">&laquo;</span>-->
<!--                  <span class="sr-only">Previous</span>-->
<!--                </a>-->
<!--              </li>-->
<!--              <li class="page-item"><a class="page-link" href="dashboard.html">1</a></li>-->
<!--              <li class="page-item active"><a class="page-link" href="dashboard.html">2</a></li>-->
<!--              <li class="page-item"><a class="page-link" href="dashboard.html">3</a></li>-->
<!--              <li class="page-item">-->
<!--                <a class="page-link" href="dashboard.html" aria-label="Next">-->
<!--                  <span aria-hidden="true">&raquo;</span>-->
<!--                  <span class="sr-only">Next</span>-->
<!--                </a>-->
<!--              </li>-->
<!--            </ul>-->
<!--          </nav>-->
<!--        </div>-->
        <!-- pagination -->

      </div>
    </div>
    <!-- Row End -->
  </div>
  <!-- Container End -->
</section>

<!--============================
=            Footer            =
=============================-->

<!--/ Footer Start /-->
<div th:replace="~{/fragments/footer :: footer}"></div>
<!--/ Footer End /-->

<!-- 
Essential Scripts
=====================================-->

<script>
  function rateProfile(profileId, rating) {
    fetch(`/profiles/${profileId}/rate`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').getAttribute('content') // CSRF token pentru Spring Security
      },
      body: JSON.stringify({ rating: rating })
    })
            .then(response => response.json())
            .then(data => {
              // Actualizează interfața utilizatorului cu noul rating
              document.querySelectorAll('.star').forEach(star => {
                star.classList.toggle('filled', parseInt(star.getAttribute('data-index')) <= data.newRating);
              });
            })
            .catch(error => console.error('Error:', error));
  }
</script>


<script th:src="@{/plugins/jquery/jquery.min.js}"></script>
<script th:src="@{/plugins/bootstrap/popper.min.js}"></script>
<script th:src="@{/plugins/bootstrap/bootstrap.min.js}"></script>
<script th:src="@{/plugins/bootstrap/bootstrap-slider.js}"></script>
<script th:src="@{/plugins/tether/js/tether.min.js}"></script>
<script th:src="@{/plugins/raty/jquery.raty-fa.js}"></script>
<script th:src="@{/plugins/slick/slick.min.js}"></script>
<script th:src="@{/plugins/jquery-nice-select/js/jquery.nice-select.min.js}"></script>
<!-- google map -->
<!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU" defer></script>
<script src="plugins/google-map/map.js" defer></script>-->

<script th:src="@{/js/script.js}"></script>

</body>

</html>